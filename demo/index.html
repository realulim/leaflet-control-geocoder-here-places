<!DOCTYPE html>
<html>
<head>
    <title>Leaflet Control Geocoder</title>

	<meta name='viewport' content='width=device-width, user-scalable=no initial-scale=1, maximum-scale=1'>
	<meta charset="UTF-8"><meta content="origin" name="referrer">

    <link rel="stylesheet" href="../node_modules/leaflet/dist/leaflet.css"/>
    <link rel="stylesheet" href="../node_modules/leaflet-control-geocoder/dist/Control.Geocoder.css"/>

    <script src="../node_modules/leaflet/dist/leaflet.js"></script>
    <script src="../dist/Control.Geocoder.js"></script>
    <script src="../dist/Control.Geocoder.HerePlaces.js"></script>
    <style type="text/css">
        body {
            margin: 0;
        }

        #map {
            position: absolute;
            width: 100%;
            height: 100%;
        }
    </style>
</head>
<body>
<div id="map"></div>

<script type="text/javascript">
    navigator.geolocation.getCurrentPosition(function (pos) {
        let param = pos.coords.latitude + "," + pos.coords.longitude;
        let map = L.map('map').setView([pos.coords.latitude, pos.coords.longitude], 14),
            geocoder = L.Control.Geocoder.hereplaces({
                app_id: '<insert your app_id here>',
                app_code: '<insert your app_code here>',
                geocodingQueryParams: {
                    at: param
                }
            }),
            control = L.Control.geocoder({
                geocoder: geocoder
            }).addTo(map),
            marker;

        new L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {
            minZoom: 2,
            maxZoom: 17,
            attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors',
        }).addTo(map);

        map.on('click', function (e) {
            geocoder.reverse(e.latlng, map.options.crs.scale(map.getZoom()), function (results) {
                var r = results[0];
                if (r) {
                    if (marker) {
                        marker.setLatLng(r.center).setPopupContent(r.html || r.name).openPopup();
                    } else {
                        marker = L.marker(r.center).bindPopup(r.name).addTo(map).openPopup();
                    }
                }
            })
        })
    });
</script>
</body>
</html>
